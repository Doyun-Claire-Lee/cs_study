# 파일과 디스크

- 파일시스템은 파일을 파일제어테이블을 통하여 관리함.
- 파일제어테이블에는 파일이 시작하는 블록의 위치정보가 담겨있음.
- 블록 하나는 1~8kb 정도의 크기임
- 하나의 파일은 여러개의 블록으로 이루어지는데, 이 블록들을 어떻게 할당하느냐에 따라 연속할당과 불연속할당으로 나뉨.
- 연속할당: 파일을 구성하는 블록들을 디스크에 연속적으로 저장
    - 파일의 시작 블록만 알면 파일의 전체를 찾을 수 있음
    - 외부단편화가 발생하기 때문에 실제론 사용되지 않음
- 불연속할당: 디스크의 비어있는 공간에 데이터를 분산하여 저장
  - 분산된 블록들은 파일 시스템이 관리
  - 1. 연결할당
     - 연결리스트 자료구조
     - 노드(포인터+데이터)
     - 파일테이블에는 시작블록의 정보만 저장하고 나머지는 연결리스트를 통해 접근하는 방식
  - 2. 인덱스할당
     - 테이블의 블록포인터가 데이터블록에 직접 연결하는것이 아닌 데이터의 인덱스를 가지고있는 인덱스블록에 연결
     - 데이터가 많아서 데이터가 꽉 찬 경우 인덱스블록을 더 만들어 연결하기 때문에 테이블을 확장할 수 있음
     - inode: 파일의 크기가 크다면 2중간접포인터, 3중간접포인터를 이용(유닉스, 리눅스에서 많이 이용)

### 블록의 크기
- 너무 작다면 낭비되는 공간이 적지만 관리해야 하는 블록의 수가 늘어남
- 너무 크다면 내부단편화로 낭비되는 공간 발생

### Free block list
- 데이터를 저장할 때 빈공간을 찾기위해 모든 블록을 확인하는 것은 비효율적
- 이를 방지하기 위해 파일 시스템은 빈공간을 모아둔 free block list를 가지고 있음.
- 파일 삭제시 파일 시스템은 데이터가 저장된 모든 블록을 지우는 것이 아닌 파일 테이블의 헤더를 삭제하고 free block list에 추가
- 파일이 삭제된것처럼 보이지만 파일이 저장되었던 블록에는 데이터가 그대로 남아있음.
